[1;32m# [0m[1;32mAGENTS.md[0m

You are collaborating with a highly opinionated Go
architect. Optimize for Go-idiomatic design, separation of
concerns, correctness, and developer experience (DX). Speed
and volume are secondary.

[1;34m## [0m[1;34mContext[0m

[35mmdf[0m is a streaming Markdown ‚Üí ANSI renderer with a growing
AST and live output. The core invariants:

[36m1.[0m [1m[1;37mStreaming is primary:[0m parse incrementally from an
   [35mio.Reader[0m and render as data arrives.
[36m2.[0m [1m[1;37mNo full buffering:[0m never [35mio.ReadAll[0m/buffer the entire
   payload to render.
[36m3.[0m [1m[1;37mAST grows live:[0m the document is usable while it is still
   being built.
[36m4.[0m [1m[1;37mRender to an ANSI token stream[0m (text + style), then
   wrap/reflow as the [1m[1;37mfinal step per emitted segment[0m (no
   retroactive reflow).
[36m5.[0m [1m[1;37mWidth only enters at the last step[0m (no wrap logic in the
   AST renderer).
[36m6.[0m [1m[1;37mZero/near-zero alloc[0m in hot paths, especially repeated
   renders.
[36m7.[0m [1m[1;37mParity target:[0m the streaming renderer must be
   byte‚Äëfor‚Äëbyte identical to the goldmark-based renderer
   for [35mtestdata/mdtest/TEST.md[0m.
[36m8.[0m [1m[1;37mSample data:[0m use [35mtestdata/mdtest/TEST.md[0m for tests/demos.

Suggested stack (temporary for parity):

[36m-[0m github.com/yuin/goldmark + extension.GFM (parity reference
  only; streaming is the long-term path)
[36m-[0m github.com/muesli/reflow/wordwrap +
  github.com/muesli/reflow/ansi

[1;34m## [0m[1;34mWorkflow (mandatory)[0m

[36m1.[0m Restate the goal and constraints in your own words.
[36m2.[0m Propose 1‚Äì3 designs with explicit tradeoffs (complexity,
   maintainability, DX, performance, risk).
[36m3.[0m Get alignment before writing significant code.
[36m4.[0m [1m[1;37mProve correctness via tests (see Quality & Verification[0m
   [1m[1;37mgates).[0m
[36m5.[0m If asked to commit, use Conventional Commits.

[1;34m## [0m[1;34mRefactors (strong preference)[0m

[36m-[0m Avoid feature flags for refactoring tasks.
[36m-[0m Prefer clean refactors with a clear cutover:

  [36m-[0m No lingering legacy implementations, structs, or
    parallel code paths.
  [36m-[0m Remove dead code and migrate call sites in the same
    change set or sequence.
[36m-[0m Only keep parallel implementations or legacy structures if
  explicitly requested.

[1;34m## [0m[1;34mArchitecture & packaging[0m

[36m-[0m Separation starts at the package boundary:

  [36m-[0m Public API packages for exported surfaces.
  [36m-[0m [35minternal/...[0m for non-exported implementation details.
[36m-[0m If there are two or more variants or adapters of an
  implementation: [1m[1;37muse an interface[0m.
[36m-[0m Constructors:

  [36m-[0m Provide a [35mNew...[0m constructor for implementations.
  [36m-[0m [1m[1;37mConstructors must return the interface type, never a[0m
    [1m[1;37mconcrete type.[0m
[36m-[0m Cyclic imports:

  [36m-[0m If cycles occur, extract core functionality into a [35mcore[0m
    package or subpackage so both main/module code and
    subpackages can import it without cycles.

[1;34m## [0m[1;34mPublic API shape (strong preference)[0m

[36m-[0m Inputs:

  [36m-[0m If a user-facing function or interface method takes more
    than 4 parameters total (including [35mcontext.Context[0m),
    move non-[35mctx[0m inputs into a request struct (e.g.
    [35mFooRequest[0m).
[36m-[0m Outputs:

  [36m-[0m A user-facing function or interface method must return
    [1m[1;37mno more than two values[0m: [35m(T, error)[0m or [35m(Response, error)[0m
    .
  [36m-[0m If multiple outputs are required, return a
    response/result struct as the first value.

[1;34m## [0m[1;34mDocumentation & generators[0m

[36m-[0m Every package must have a [35mdoc.go[0m with standard Go package
  documentation.
[36m-[0m Code generation:

  [36m-[0m If generators are not tightly bound to a single package,
    place [35mgenerate.go[0m at the module root.
  [36m-[0m If tightly bound to a package, place [35mgenerate.go[0m in that
    package and any generator [35mmain[0m packages underneath as
    appropriate.

[1;34m## [0m[1;34mQuality & verification gates (primary)[0m

[36m-[0m [1m[1;37mAssume minimal or no human code review.[0m
[36m-[0m [1m[1;37mVerification is the primary quality gate.[0m
[36m-[0m Every new feature, behavior, fix, or refactor [1m[1;37mmust[0m be
  proven with comprehensive unit tests and/or integration
  tests.
[36m-[0m Prefer tests that assert [1m[1;37mobservable behavior[0m over
  implementation details.
[36m-[0m Treat tests as executable specification; code exists to
  satisfy them.
[36m-[0m Optimize for self-verifying systems where correctness is
  falsifiable by tests, not inferred by reading code.
[36m-[0m Code review is secondary and optional: useful for
  architecture, pedagogy, and high-level critique‚Äînot as the
  main correctness mechanism.

[1;35m### [0m[1;35mMandatory checks before ‚Äúdone‚Äù[0m

[36m-[0m [35mgo test ./...[0m
[36m-[0m [35mgo vet ./...[0m
[36m-[0m [35mgolint ./...[0m
[36m-[0m [35mgolangci-lint run ./...[0m

[1;34m## [0m[1;34mCommits[0m

[36m-[0m All git commit messages [1m[1;37mmust[0m follow the Conventional
  Commits specification ([35mtype(scope): summary[0m).
[36m-[0m If you are asked to commit, choose the narrowest correct
  type and keep messages factual and outcome-oriented.

[1;34m## [0m[1;34mRepo hygiene[0m

[36m-[0m If [35m.golangci.yml[0m does not exist in the repo root, create
  and seed it with:

  [32mversion: "2"[0m
  [32mlinters:[0m
  [32m  disable:[0m
  [32m    -[0m[32m errcheck[0m
  [32m  exclusions:[0m
  [32m    rules:[0m
  [32m      #[0m[32m staticcheck style nits we don't want to chase[0m
  [32m      -[0m[32m linters: [staticcheck][0m
  [32m        text: "QF1003"[0m
  [32m      -[0m[32m linters: [staticcheck][0m
  [32m        text: "S1017"[0m
  [32m      -[0m[32m linters: [staticcheck][0m
  [32m        text: "QF1001"[0m
  [32m      -[0m[32m linters: [staticcheck][0m
  [32m        text: "S1009"[0m
